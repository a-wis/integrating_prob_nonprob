# geom_point(col = "orange",size=0.8) +
#  geom_line(size=0.8,alpha = 0.1,col="orange") +
g1=g+geom_line(size=1.1,alpha = 0.7,
aes(x=Age, y = Data, colour = Source, group=Source)) +
scale_colour_manual(values=c("red", "blue"))
g1
g=ggplot(data = inp,
aes(x = Age, y = q50, ymin=q25,ymax=q75, group=1,fill=Source,colour=Source)) +
facet_grid(facets = Sending ~ Receiving, scales="free",switch = "y") +
geom_line(size=1,alpha = 0.3,col="#E69F00") +
geom_ribbon(alpha = 0.5, col="#E69F00",fill="#E69F00",aes(fill=Source)) +
scale_y_continuous(name="Counts") +
scale_x_discrete(expand=expand_scale(add = 0)) +
theme(axis.text.x=element_blank(),axis.ticks.x=element_blank())
# geom_point(col = "orange",size=0.8) +
#  geom_line(size=0.8,alpha = 0.1,col="orange") +
g1=g+geom_line(size=1.1,alpha = 0.7,
aes(x=Age, y = Data, colour = Source, group=Source)) +
scale_colour_manual(values=c("red", "blue"))
+
ggsave(filename = "../Presentations/Migration/Plots/plot_odas_all.pdf",plot = g1,device = "pdf",width=10,height=6.5)
+
ggsave(filename = "../Presentations/Migration/Plots/plot_odas_all.pdf",plot = g1,device = "pdf",width=10,height=6.5)
300/700
1/10^.5
exp(1/10)
exp(0.04472)
exp(3+0.04472)
exp(3)
exp(30+0.04472)
exp(10+0.04472)
exp(10)
21.00415/20.08554
1/0.01
1/0.01^2
1/5000^.5
1/0.015^2
1/0.03^2
1/0.012^2
1/0.014^2
x=seq(0,1e5,1)
range(x^.5)
range(log(x))
range(log10(x))
range(log2(x))
range(x^(1/3))
range(x^(1/5))
range(x^(1/10))
range(x^(1/9))
range(x^(1/8))
range(x^(1/6))
range(x^(1/5))
plot(log(x))
lines(x^(1/5))
lines(x^(1/10))
plot(log(seq(0,100,0.1)))
plot((seq(0,100,0.1))^(1/5))
plot(log(seq(0,100,0.1)))
lines((seq(0,100,0.1))^(1/5))
lines((seq(0,100,0.1))^(1/5)-1)
lines(((seq(0,100,0.1))^(1/5)-1)*5)
plot(((seq(0,100,0.1))^(1/5)-1)*5)
lines(log(seq(0,100,0.1)))
plot(((seq(0,100,0.1))^(1/5)-1)*5,t="l",col="red")
lines(log(seq(0,100,0.1)))
plot(((seq(0,100,0.1))^(1/100)-1)*100,t="l",col="red")
plot(((seq(0,100,0.1))^(1/10)-1)*10,t="l",col="red")
0^(1/10)
(0^(1/10)-1)*10
(0^(1/10)-1)
plot(((seq(0,100,0.1))^(1/10)-1),t="l",col="red")
lines(log(seq(0,100,0.1)))
load("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/PhD/Andrea Aparicio Castro/IMEM reconstruction/US_model/IMEM0208_data.RData")
library("dplyr")
library("tidyr")
library("rvest")
library("ggplot2")
get_data <- function(country, year) {
c1 <- "https://www.census.gov/data-tools/demo/idb/region.php?N=%20Results%20&T=10&A=separate&RT=0&Y="
link='//*[@id="tabcontent_IDB__Results_"]/div[2]/div[1]/div[1]/table'
c2 <- "&R=-1&C="
url <- paste0(c1, year, c2, country)
df <- url %>%
read_html() %>%
html_nodes(xpath=link) %>%
html_table()
df = df[[1]]
keep <- c(1, 2, 4, 5)
df <- df[,keep]
names(df) <- c("Year", "Age", "Male", "Female")
cols <- 3:4
df[,cols] <- apply(df[,cols], 2, function(x) as.numeric(as.character(gsub(",", "", x))))
df <- df[df$Age != 'Total', ]
df$Male <- -1 * df$Male
df$Age <- factor(df$Age, levels = df$Age, labels = df$Age)
df.ret <- df %>%
gather("Sex","Population",Male:Female) %>%
mutate(Sex=as.factor(Sex))
# require(reshape2)
# df.melt <- melt(df,
#                 value.name='Population',
#                 variable.name = 'Sex',
#                 id.vars=c('Year','Age') )
return(df.ret)
}
data_uk_years = get_data("UK", "1993,1998,2003,2008,2013,2018")
data_uk1 = data_uk_years %>%
spread(Sex, Population)
data_uk1 = data_uk_years %>%
spread(Sex, Population) %>%
mutate(`Sex ratio` = Males/Females*100)
data_uk1 = data_uk_years %>%
spread(Sex, Population) %>%
mutate(`Sex ratio` = Male/Female*100)
data_uk1 = data_uk_years %>%
spread(Sex, Population) %>%
mutate(`Sex ratio` = abs(Male)/Female*100)
ggplot(data_uk1, aes(x = as.number(Age, y = `Sex ratio`, colour = Year)) +
geom_line(aes(group = as.numeric(Age), colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = Year)) +
geom_line(aes(group = as.numeric(Age), colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = as.numeric(Age), y = `Sex ratio`, colour = Year)) +
geom_line(aes(group = as.numeric(Age), colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = Year)) +
geom_line(aes(x = Age, colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = Year)) +
geom_line(aes(x = as.numeric(Age), colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = as.numeric(Age), y = `Sex ratio`, colour = Year)) +
geom_line(aes(x = as.numeric(Age), colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = as.numeric(Age), y = `Sex ratio`, colour = Year)) +
geom_line(aes(colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = as.character(Age), y = `Sex ratio`, colour = Year)) +
geom_line(aes(colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = (Age), y = `Sex ratio`, group=Year, colour = Year)) +
geom_line(aes(group=Year, colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=Year, colour = Year)) +
geom_line(aes(group=Year, colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = as.integer(Year))) +
geom_line(aes(colour = Year), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = as.integer(Year))) +
geom_line(aes(colour = as.integer(Year)), size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=Year, colour = Year)) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.integer(Year), colour = Year)) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.integer(Year), colour = as.integer(Year))) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.integer(Year), colour = Year)) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.factor(Year), colour = Year)) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.factor(Year), colour = as.factor(Year))) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=as.factor(Year), colour = Year)) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=Year, colour = as.factor(Year))) +
geom_line(size=1.5) +
xlab("Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, colour = as.factor(Year))) +
geom_line(size=1.5) +
scale_color_discrete(name="Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
ggplot(data_uk1, aes(x = Age, y = `Sex ratio`, group=Year, colour = as.factor(Year))) +
geom_line(size=1.5) +
scale_color_discrete(name="Year") +
theme(plot.title = element_text(lineheight=.8, face="bold"), axis.text.x  = element_text(angle=90, vjust=0.5), legend.position = "right")
data_ukhu = get_data(c("UK,HU", "1993")
data_ukhu = get_data(c("UK,HU"), "1993")
View(data_ukhu)
data_uk = get_data("UK", 2018)
data_hu = get_data("HU", 2018)
data_uk = data_uk %>%
mutate(Country="UK")
data_ukhu = data_uk %>%
bind_rows(data_hu)
data_ukhu = data_uk %>%
bind_rows(data_hu) %>%
mutate(Country=as.factor(Country))
View(data_ukhu)
data_hu = data_hu %>%
mutate(Country="HU")
data_ukhu = data_uk %>%
bind_rows(data_hu) %>%
mutate(Country=as.factor(Country))
library(tidyr)
library(dplyr)
load("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/Mortality CoD/Mortality COD/Data_inp.RData")
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,aux,sep="X") %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,sep="X") %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(aux,Year,sep="X") %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,"aux",sep="X") %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,"aux","Year",sep="X") %>% mutate(Sex=as.factor(Sex))
?separate
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,c("aux","Year"),sep="X") %>% mutate(Sex=as.factor(Sex))
p1=p %>% gather("Year","Value",X1969:X2016) %>% droplevels() %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex), Year=as.numeric(Year))
fit1 = glm(Value ~ Age + Sex + Year)
fit1 = glm(Value ~ Age + Sex + Year, family = "Poisson",data = p1)
?glm
fit1 = glm(Value ~ Age + Sex + Year,data = p1)
summary(fit1)
fit = rpart(Value ~ Age + Sex + Year,data = p1, method = "Poisson")
library(rpart)
fit2 = rpart(Value ~ Year,data = p1, method = "Poisson")
fit2 = rpart(Value ~ Year,data = p1, method = "class")
summary(fit2)
plot(fit1)
plot(fit2)
fit2 = rpart(Value ~ Age + Sex + Year,data = p1, method = "class")
plot(fit2)
str(kyphosis)
kyphosis
load("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/Arek-Joe Share/Voting/Data/GIP_Data.Rdata")
table(prob.survey$survey)
fit3 = glm(voted ~ age + female,data = prob.survey,family = "binomial")
summary(fit3)
fit3 = glm(voted ~ age + age^2 + female,data = prob.survey,family = "binomial")
summary(fit3)
prob.survey = prob.survey %>% mutate(age2=age^2)
fit3 = glm(voted ~ age + age2 + female,data = prob.survey,family = "binomial")
summary(fit3)
plot(fit3)
fit3 = glm(voted ~ age + age2 + female,data = prob.survey,family = binomial(link='logit'))
plot(fit3)
summary(fit3)
anova(fit3, test="Chisq")
summary(fit3$fitted.values)
plot(fit3$y, fit3$fitted.values)
hist(fit3$y)
summary(fit3$y)
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class")
plot(fit4)
summary(fit4)
fit5 = rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
plot(fit5)
ggplot(fit5)
pdf("fit5.pdf",7,5)
plot(fit5)
dev.off()
library("rpart.plot")
install.packages("rpart.plot")
library("rpart.plot")
plot(fit5)
rpart.plot(fit5)
rpart.plot(fit4)
summary(fit5)
summary(fit5)
rpart.plot(fit4)
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class",control = rpart.control(cp=0.05))
rpart.plot(fit4)
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class",control = rpart.control(cp=0.01))
rpart.plot(fit4)
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class",control = rpart.control(cp=0.001))
rpart.plot(fit4)
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class",control = rpart.control(cp=0.005))
rpart.plot(fit4)
install.packages("randomForest")
library("randomForest")
fit4 = rpart(voted ~ age + age2 + female,data = prob.survey,method = "class")
rpart.plot(fit4)
fit5 = randomForest(voted ~ age + age2 + female,data = prob.survey,method = "class")
fit5 = randomForest(voted ~ age + age2 + female,data = prob.survey)
?randomForest
rpart.plot(fit2)
fit2 = rpart(Value ~ Year,data = p1, method = "class")
fit2 = rpart(Value ~ Age + Sex + Year,data = p1, method = "Poisson")
fit2 = rpart(Value ~ Age + Sex + Year,data = p1, method = "poisson")
rpart.plot(fit2)
fit2 = rpart(Value ~ Age + Sex + Year,data = p1, method = "class")
rpart.plot(fit2)
fit2 = rpart(Value ~ Age + Sex + Year,data = p1, method = "anova")
rpart.plot(fit2)
rpart.plot(fit2)
rpart.plot(fit2)
?rpart.plot
rpart.plot(fit2,cex=3)
rpart.plot(fit2,cex=1.1)
rpart.plot(fit2,cex=1.01)
rpart.plot(fit2,cex=1.001)
rpart.plot(fit2,cex=1.005)
rpart.plot(fit2,cex=1.0001)
rpart.plot(fit2,cex=1)
rpart.plot(fit2,cex=0.5)
rpart.plot(fit2,cex=0.7)
summary(fit2)
fit21 = randomForest(Value ~ Age + Sex + Year,data = p1)
plot(fit21)
summary(fit21)
print(fit21)
print(importance(fit21,type =2))
print(importance(fit21,type =1))
print(importance(fit21,type =0))
print(importance(fit21,type =3))
print(importance(fit21,type =2))
print(importance(fit21))
print(fit21)
p1
fit1
plot(fit1)
plot(fit1$coefficients)
x_train=filter(d,Sex=="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex,Sex_code,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex), Year=as.numeric(Year))
x_train=filter(d,Sex!="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex,Sex_code,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex), Year=as.numeric(Year))
table(d$Sex)
x_train=filter(d,Sex!="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex_code,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex_code), Year=as.numeric(Year))
x_train=filter(d,Sex!="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex_code), Year=as.numeric(Year))
x_train=filter(d,Sex!="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex_code), Year=as.numeric(Year)) %>% select(-Sex_code)
head(x_train)
fit1 = glm(Value ~ Age + Sex + Year, family = "Poisson",data = p1)
fit1 = glm(Value ~ Age + Sex + Year, family = "poisson",data = p1)
fit1
plot(fit1$coefficients)
library(ggplot2)
fit1 = glm(Value ~ Age + Sex + Year, family = "poisson",data = x_train)
fit1 = glm(Counts ~ Age + Sex + Year, family = "poisson",data = x_train)
plot(fit1$coefficients)
plot(fit1)
ggplot(x = Age, y=Value, data=x_train) + geom_line()
ggplot(aes(x = Age, y=Value, data=x_train)) + geom_line()
str(x_train)
ggplot(data=x_train, aes(x = Age, y=Value)) + geom_line()
ggplot(data=x_train, aes(x = Age, y=Counts)) + geom_line()
ggplot(data=x_train, aes(x = Age, y=Counts)) + geom_points()
ggplot(data=x_train, aes(x = Age, y=Counts)) + geom_point()
ggplot(data=x_train %>% group_by(Year) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Age, y=Counts)) + geom_point()
ggplot(data=x_train %>% group_by(Age) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Age, y=Counts)) + geom_point()
ggplot(data=x_train %>% group_by(Year) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts)) + geom_point()
ggplot(data=x_train %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
x_test = filter(x_train,Year>2006)
x_test
x_test = filter(x_train,Year>2006) %>% mutate(Year=Year+6)
head(x_test)
x_test = filter(x_train,Year>2006) %>% mutate(Year=Year+6,Counts=NA)
head(x_test)
pred1= predict.glm(x_train,fit1)
?predict.glm
pred1= predict.glm(fit1, x_train)
pred1
dim(pred1)
length(pred1)
pred1= predict.glm(fit1)
length(pred1)
pred1= predict.glm(fit1,newdata = select(x_test,-Counts),type="response")
length(pred1)
all1=bind_rows(fit1,cbind(x_test,pred1))
cbind(x_test,pred1)
all1=bind_rows(fit1,cbind(select(x_test,-Counts),pred1))
all1=bind_rows(fit1,x_test))
all1=bind_rows(fit1,x_test)
all1=bind_rows(x_train,cbind(select(x_test,-Counts),pred1))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1,colour=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
x_train=filter(d,Sex!="Both sexes",Cause_code=="06",Age!="All ages") %>% select(-c(Sex,Cause, Cause_code)) %>% droplevels() %>% gather("Year","Counts",X1969:X2012) %>% separate(Year,c("aux","Year"),sep="X") %>% select(-aux) %>% mutate(Sex=as.factor(Sex_code), Year=as.numeric(Year), Counts=as.numeric(Counts)) %>% select(-Sex_code)
ggplot(data=x_train %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
x_test = filter(x_train,Year>2006) %>% mutate(Year=Year+6,Counts=NA)
fit1 = glm(Counts ~ Age + Sex + Year, family = "poisson",data = x_train)
pred1= predict.glm(fit1,newdata = select(x_test,-Counts),type="response")
all1=bind_rows(x_train,cbind(select(x_test,-Counts),pred1))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1,colour=Sex))
ggplot(data=x_train %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1,colour=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(x=Year, y = pred1,aes(colour=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1))
View(all1)
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1))
all1[Year>2012]$Counts=pred1
all1$Counts[Year>2012]=pred1
all1[,Year>2012]$Counts=pred1
all1[,Year>2012]$Counts
all1[,Year>2012]
all1[Year>2012]=pred1
all1[Year>2012]
all1["Year">2012]
all1["Year">2012]$Counts=pred1
all1[,"Year">2012]$Counts=pred1
all1[,"Year">2012]$Counts
all1$Counts["Year">2012]=pred1
all1$Counts["Year">2012]
all1=bind_rows(x_train,cbind(select(x_test,-Counts),pred1))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point(aes(x = Year, y=Counts, colour=Sex)) + geom_line(aes(x=Year, y = pred1))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point(aes(x = Year, y=Counts)) + geom_line(aes(x=Year, y = pred1))
pl=ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
p
pl
p + geom_line(aes(x=Year, y = pred1))
pl + geom_line(aes(x=Year, y = pred1))
pl=ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1, linetype=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = pred1, linetype=Sex))
pl
View(all1)
fit1 = glm(Counts ~ Age + Sex + Year, family = "poisson",data = filter(x_train,Year<2007))
pred1= predict.glm(fit1,newdata = select(filter(x_train,Year>2006),-Counts),type="response")
View(x_train)
all1=bind_cols(x_train,c(rep(NA,1672),pred1))
all1=cbind(x_train,c(rep(NA,1672),pred1))
c(rep(NA,1672),pred1)
all1=cbind(x_train,c(rep(NA,1672-228),pred1))
Pred=c(rep(NA,1672-228),pred1)
all1=cbind(x_train,Pred)
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point()
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_lines(aes(x=Year, y = Pred, linetype=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = Pred, linetype=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = Pred, colour=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x=Year, y = Pred, colour=Sex,linetype=Sex))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Pred, colour=Sex)) + geom_point()
ggplot(data=all1 %>% group_by(Year,Sex,Pred) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred, linetype=Sex))
ggplot(data=all1 %>% group_by(Year,Sex,Pred) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred, colour=Sex))
ggplot(data=all1 %>% group_by(Year,Sex,Pred) %>% summarise(Counts=mean(Counts)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred))
ggplot(data=all1 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred))
?predict
fit2 = rpart(Counts ~ Age + Sex + Year,data = filter(x_train,Year<2007), method = "class")
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
Pred2=c(rep(NA,1672-228),pred2)
all2=cbind(all1,Pred2)
View(pred2)
pred2= predict(fit2,data = select(filter(x_train,Year>2006),-Counts))
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
plot(pred2[[1]])
str(pred2)
plot(pred2)
View(pred2)
fit2 = rpart(Counts ~ Age + Sex + Year,data = filter(x_train,Year<2007), method = "poisson")
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
Pred2=c(rep(NA,1672-228),pred2)
all2=cbind(all1,Pred2)
ggplot(data=all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred2))
group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup()
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup()
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup() filter(Year>2006)
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup() %>% filter(Year>2006)
rpart.plot(fit2)
fit2 = rpart(Counts ~ Age + Sex + Year,data = filter(x_train,Year<2007), method = "poisson",model=T)
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
Pred2=c(rep(NA,1672-228),pred2)
all2=cbind(all1,Pred2)
ggplot(data=all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred2))
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup() %>% filter(Year>2006)
rpart.plot(fit2)
fit2 = rpart(Counts ~ Age + Sex + Year,data = filter(x_train,Year<2007), method = "poisson",model=T,control = rpart.control(cp=0.005))
rpart.plot(fit2)
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
Pred2=c(rep(NA,1672-228),pred2)
all2=cbind(all1,Pred2)
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup() %>% filter(Year>2006)
fit2 = rpart(Counts ~ Age + Sex + Year,data = filter(x_train,Year<2007), method = "poisson",model=T,control = rpart.control(cp=0.001))
rpart.plot(fit2)
pred2= predict(fit2,newdata = select(filter(x_train,Year>2006),-Counts))
Pred2=c(rep(NA,1672-228),pred2)
all2=cbind(all1,Pred2)
rpart.plot(fit2)
all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup() %>% filter(Year>2006)
ggplot(data=all2 %>% group_by(Year,Sex) %>% summarise(Counts=mean(Counts),Pred=mean(Pred), Pred2=mean(Pred2)) %>% ungroup(), aes(x = Year, y=Counts, colour=Sex)) + geom_point() + geom_line(aes(x = Year, y = Pred2))
save.image("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/Proposed ideas/AIML/ML_tryout.RData")
savehistory("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/Proposed ideas/AIML/ML_history.Rhist")
log(2)
1/log(2)
library(readxl)
Americas <- read_excel("C:/Users/msassaw5/Dropbox (The University of Manchester)/Research/Proposed ideas/ORA migration/Americas.xlsx",
col_types = c("text", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric"))
View(Americas)
setwd("C:/Users/msassaw5/Dropbox (The University of Manchester)/GitHub/integrating_prob_nonprob/Markdown")
.libPaths()
require(installr)
require(installr,lib.loc = "P:/R/win-library/3.6")
install.pandoc()
